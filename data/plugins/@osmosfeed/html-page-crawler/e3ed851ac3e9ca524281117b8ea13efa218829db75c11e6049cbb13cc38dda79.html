<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.62ab618efddefb603269.css" data-identity="gatsby-global-css">@import url(https://fonts.googleapis.com/css2?family=DM+Mono&family=Inter:wght@400;700&display=swap);pre[class*=language-].line-numbers{padding-left:3.8em}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;left:-3.8em;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}:root{--primary:#7d87ff;--link-color:#fff;--border-color:#111;--heading-font-color:var(--primary);--background-color:#272727;--sidebar-color:#222;--navbar-color:#333;--sidebar-color-hover:#303030;--sidebar-color-focus:#444;--category-background-color:#161616;--category-background-color-hover:#2a2a2a;--light-border-color:#444;--toolbar-background-color:#1b1b1b;--toolbar-color:#eee;--tooltip-border-color:#555;--tooltip-background-color:#232323;--font-color:#b3b9c5;--medium-font-color:#aaa;--dark-font-color:#8f949d;--bright-font-color:#eee;--input-background:#393939;--blockquote-background-color:rgba(0,0,0,0.4);--blockquote-color:var(--light-font-color);--black:#111;--inline-code-background-color:rgba(0,0,0,0.2);--inline-code-color:#eee;--h2-filter:brightness(1);--h3-filter:brightness(1.3);--h4-filter:brightness(1.5);--dark-opacity:rgba(0,0,0,0.2);--dark-opacity-hover:rgba(0,0,0,0.3);--reverse:#111;--scrollbar:var(--border-color);--scrollbar-track:var(--light-border-color);--yellow:#ffb038;--font-family:"GT Walsheim",-apple-system,BlinkMacSystemFont,"Inter","Helvetica Neue","Roboto",Roboto,Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--heading-font-family:"GT Walsheim Bold",-apple-system,BlinkMacSystemFont,"Helvetica Neue","Roboto",Roboto,Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--code-font-family:"GT Pressura Mono",Menlo,"DM Mono","Roboto Mono",Courier New,monospace}*,:after,:before{box-sizing:border-box}a:focus-visible,button:focus-visible{outline:3px solid var(--primary)}body{-webkit-font-smoothing:antialiased;background:var(--background-color);font-family:var(--font-family);font-size:1rem;line-height:1.6;margin:0}blockquote,ol,p,table,ul{font-size:1.2rem;margin:0 0 2rem}button{appearance:none;-moz-appearance:none;-webkit-appearance:none;background:transparent;border:none;cursor:pointer}ul{padding-left:1.5rem}ul li{margin-bottom:.5rem}ul li p{margin:0}ul li ul{margin:.5rem}h1,h2,h3,h4,h5{color:var(--heading-font-color);font-family:var(--heading-font-family);line-height:1.2;margin:0 0 1.5rem;scroll-margin-top:60px}a{text-decoration:none}a.button{background:var(--primary);border:1px solid var(--primary)!important;color:var(--reverse);display:block;padding:.5rem 1rem}a.button:hover{-webkit-filter:brightness(1.1);filter:brightness(1.1)}a.button.icon-button{align-items:center;display:flex}a.button.icon-button img{margin-right:.5rem;max-height:30px}table{border-collapse:separate;border-spacing:0;display:block;max-width:100%;overflow-x:auto;width:100%}tbody,thead{white-space:nowrap}th{border-bottom:2px solid var(--border-color)}tfoot th{border-top:1px solid var(--border-color)}td{border-bottom:1px solid var(--border-color)}td,th{-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;padding:.75rem!important;text-align:left;word-break:break-word}tbody tr:nth-child(odd){background-color:var(--dark-opacity)}@media screen and (min-width:800px){table{border:1px solid var(--border-color);display:table}tbody,thead{white-space:normal}}.navbar{background:var(--navbar-color);display:flex;height:calc(100vh - 28px);min-width:80px;position:fixed;top:0;z-index:10}.navbar section{display:flex;flex-direction:column;justify-content:space-between;width:100%}.navbar a,.navbar button{align-items:center;border-left:3px solid transparent;border-right:3px solid transparent;color:var(--font-color);display:flex;justify-content:center;padding:1rem;position:relative;transition:border .2s ease}.navbar img{-webkit-filter:drop-shadow(4px 3px 1px rgba(0,0,0,.4));filter:drop-shadow(4px 3px 1px rgba(0,0,0,.4))}.navbar a:hover,.navbar button:hover{background:var(--dark-opacity)}.navbar a.active,.navbar a:focus{background:var(--dark-opacity-hover);border-left:3px solid var(--primary);outline:none}.navbar button:focus{outline:none}.navbar a .tooltip,.navbar button .tooltip{align-items:center;background:var(--tooltip-background-color);border:1px solid var(--tooltip-border-color);box-shadow:1px 10px 15px rgb(0 0 0/60%);color:var(--bright-font-color);display:none;font-size:.9rem;justify-content:center;left:120px;line-height:1.6;padding:.2rem .75rem;position:absolute;top:50%;-webkit-transform:translate3D(-50%,-50%,0);transform:translate3D(-50%,-50%,0);white-space:nowrap;width:5rem;z-index:11}.navbar a:hover .tooltip,.navbar button:hover .tooltip{display:flex}.navbar a .tooltip:before,.navbar button .tooltip:before{background:var(--tooltip-background-color);box-shadow:-1px 1px 0 0 var(--tooltip-border-color);content:"";display:block;height:.5rem;left:-.25rem;margin-top:-.25rem;position:absolute;top:50%;-webkit-transform:rotate(45deg);transform:rotate(45deg);width:.5rem}.navbar img{height:auto;max-width:40px}.sidebar{background:var(--sidebar-color);height:calc(100vh - 28px);left:80px;overflow-x:hidden;overflow-y:hidden;position:fixed;top:0;width:320px;z-index:9}.sidebar:hover{overflow-y:auto}.sidebar .title{align-items:center;background:var(--toolbar-background-color);color:var(--font-color);display:flex;font-size:.85rem;font-weight:600;height:35px;justify-content:space-between;padding:0 .5rem 0 2.5rem;position:fixed;text-transform:uppercase;top:0;width:320px;z-index:8}button.colors .colors-dropdown{background:var(--toolbar-background-color);box-shadow:0 3px 3px rgba(0,0,0,.2);display:none;left:0;position:absolute;top:35px;width:100%}button.colors.open{background:var(--toolbar-background-color);color:var(--font-color)}button.colors.open .colors-dropdown{display:block;z-index:13}.color{cursor:pointer;padding:.2rem}.color span{border-radius:50%;display:block;height:12px;width:12px}.color-selection{align-items:center;color:var(--font-color);display:flex;height:30px;justify-content:space-between;padding:0 .5rem}.color-selection:hover{background:rgba(0,0,0,.1);color:var(--bright-font-color)}.color-selection:hover span{-webkit-filter:brightness(1.1);filter:brightness(1.1)}.sidebar .categories{margin-top:35px}.sidebar button.collapse-categories{height:35px;padding:0 .75rem}.sidebar button.collapse-categories:hover{background:var(--dark-opacity)}.sidebar button.collapse-categories div{border:1px solid var(--font-color);line-height:0;padding:1px 3px}.sidebar button.collapse-categories svg rect{fill:var(--font-color)}.sidebar button.category{align-items:center;background:var(--category-background-color);border:none;color:var(--bright-font-color);cursor:pointer;display:grid;font-size:.8rem;font-weight:700;grid-template-columns:1.5rem auto;margin-bottom:1px;padding:.75rem 1rem;position:sticky;text-align:left;text-transform:uppercase;top:35px;width:100%;z-index:7}.sidebar button.category:hover{background:var(--category-background-color-hover);color:var(--bright-font-color)}.sidebar button.category:focus-visible{background:var(--primary);border-bottom:none;color:var(--reverse)!important;outline:none}.sidebar button.category:focus{color:var(--bright-font-color);outline:none}.sidebar button.category svg{margin-right:.5rem}.sidebar button.category:focus svg path,.sidebar button.category svg path{stroke:var(--bright-font-color)}.sidebar button.category:focus-visible svg path{stroke:var(--reverse)}.sidebar nav{width:320px}.sidebar nav.collapsed{display:none}.sidebar a{align-items:center;border-left:3px solid transparent;color:var(--medium-font-color);display:grid;font-family:var(--heading-font-family);font-size:.85rem;grid-template-columns:2rem auto;line-height:1.2;padding:.4rem 1rem}.sidebar a svg path{-webkit-filter:var(--icon-filter);filter:var(--icon-filter)}.sidebar a:hover{background:var(--sidebar-color-hover);color:var(--bright-font-color)}.sidebar a.active,.sidebar a:focus{background:var(--sidebar-color-focus);border-left:3px solid var(--primary);color:var(--bright-font-color);outline:none}.sidebar a.active svg path{fill:var(--primary)}.footer{background:var(--toolbar-background-color);bottom:0;height:28px;left:0;position:fixed;width:100%;z-index:10}.footer section{align-items:stretch;display:flex;height:100%;justify-content:space-between}.footer img{display:inline-block;max-height:20px;width:auto}.footer nav{display:flex;gap:.25rem;margin:0 1rem}.footer a,.footer span{align-items:center;color:var(--dark-font-color);display:flex;font-size:.8rem;line-height:28px;padding:0 .5rem}.footer span{color:var(--toolbar-color)}.footer a:hover{background:var(--dark-opacity);color:var(--bright-font-color);cursor:pointer}main{margin-left:400px;margin-top:35px}.no-sidebar main{margin-left:80px}.container{margin-left:auto;margin-right:auto;max-width:900px;padding:2rem}.container.large{max-width:1350px}.container.small,.small{max-width:550px}.file-header{background:var(--toolbar-background-color);display:flex;height:35px;justify-content:flex-start;left:400px;padding-right:.5rem;position:fixed;top:0;width:calc(100vw - 400px);z-index:9}.no-sidebar .file-header{left:80px;width:calc(100vw - 80px)}.file-header button{align-items:center;background:transparent;border:none;color:var(--font-color);cursor:pointer;display:flex;gap:.5rem;justify-content:space-between;line-height:0;padding:0 1rem;position:relative}.file-header button:hover{background:var(--dark-opacity);color:var(--font-color)}.file-header button:focus{outline:none}.file-header button:focus-visible{outline:3px solid var(--primary)}.file-header button span{font-size:.9rem}.file-header button svg rect{fill:var(--font-color)}.file{align-items:center;background:var(--background-color);border-right:1px solid var(--sidebar-color);border-top:3px solid var(--primary);border-top-right-radius:3px;color:var(--bright-font-color);display:flex;font-size:.9rem;left:0;padding:0 1rem;position:relative;top:0}.theme-switcher img{max-width:20px}.toolbar{display:flex;margin-left:auto}.toolbar button{border-left:1px solid var(--background-color)}.toolbar button:first-of-type{border-left:1px solid transparent}.hero header{padding:2rem 0 0;text-align:left}.hero h1{color:var(--bright-font-color);font-size:3.2rem;margin-bottom:1rem}.hero p.subtitle{color:var(--font-color);font-size:1.4rem}.hero .hero-buttons{align-items:center;display:flex;gap:1rem}article{margin-bottom:3rem}article header{text-align:center}article h1{color:var(--bright-font-color);font-size:2.5rem;font-weight:700;margin-bottom:.75rem}article h2,article h3,article h4,article h5{margin:0 0 1.25rem}article .description{color:var(--dark-font-color);font-size:1.4rem;margin-bottom:0}.post-details{color:var(--dark-font-color);margin:1rem 0}.tags{align-items:center;display:flex;flex-wrap:wrap;gap:.5rem;justify-content:center;margin:1.5rem 0}.tags a{background:var(--tooltip-background-color);border:1px solid var(--tooltip-border-color);color:var(--bright-font-color);display:inline-block;font-size:.9rem;font-weight:400;line-height:normal;padding:.3rem .5rem;vertical-align:middle}.tags a:hover{background:transparent;border:1px solid var(--primary);color:var(--primary);font-weight:400}article a{border-top:2px solid transparent;color:var(--link-color)}article a,article a:hover{border-bottom:2px solid var(--primary);font-weight:600}article a:hover{background:var(--primary);border-top:2px solid var(--primary);color:var(--reverse)}article li a,article li a:hover{border-bottom:none;border-top:none}article img{display:block;max-width:100%}article h2{-webkit-filter:var(--h2-filter);filter:var(--h2-filter);font-size:2.25rem;padding-bottom:.25rem}article h2 code{font-size:2.2rem!important}article h3{-webkit-filter:var(--h3-filter);filter:var(--h3-filter);font-size:1.75rem}article h3 code{font-size:1.6rem!important}article h4{-webkit-filter:var(--h4-filter);filter:var(--h4-filter);font-size:1.1rem;padding-bottom:.25rem;text-transform:uppercase}article h4 code{font-size:1.25rem!important}article h5{font-size:1rem;text-transform:uppercase}h2:not(:first-child),h3:not(:first-child),h4:not(:first-child){margin-top:3rem}blockquote{background:var(--blockquote-background-color);border:2px solid var(--tooltip-border-color);padding:1rem}blockquote p{color:var(--blockquote-color)}blockquote ul{margin-top:1rem}blockquote p:last-of-type,blockquote ul:last-of-type{margin-bottom:0}.comments{padding-bottom:2rem}.blog-page h2{border-bottom:2px solid var(--light-border-color);margin-top:2.5rem}a.post{grid-gap:1rem;align-items:center;border:1px solid transparent;display:grid;grid-template-columns:auto 60px;margin-left:-1rem;margin-right:-1rem;padding:.55rem 1rem}a.post.new,a.post:hover{background:var(--dark-opacity);border:1px solid transparent}a.post.new{background:transparent;border:1px solid transparent}a.post.new:hover{background:var(--dark-opacity)}a.post.new time{color:var(--yellow)!important}a.post.new h3{color:var(--bright-font-color)}a.post.new .new-badge{color:var(--yellow);margin-right:.75rem}a.post h3{color:var(--font-color);-webkit-filter:brightness(1);filter:brightness(1);font-size:1.1rem;font-weight:500;margin:0}a.post:hover h3{color:var(--bright-font-color)}a.post:hover time,a.post time{color:var(--dark-font-color)}a.post time{display:block;font-family:var(--code-font-family);font-size:.8rem;font-weight:400;text-align:center}.projects{display:flex;flex-direction:column}@media screen and (min-width:600px){.projects{grid-gap:2rem;display:grid;grid-template-columns:repeat(auto-fill,300px);justify-content:center}}.project{background:var(--dark-opacity);border:1px solid var(--border-color);color:var(--dark-font-color);display:flex;flex-direction:column;padding:1.5rem}.project h2{border-bottom:none;font-size:1.5rem;margin-bottom:0;text-align:center}.project .description{color:var(--font-color);font-size:1.2rem;line-height:1.3;margin-bottom:1rem;text-align:center}.project .links{display:flex;gap:.5rem}.project .stars{align-items:center;display:flex;gap:1rem;justify-content:center;margin-top:auto}.project .stars img{max-width:20px}a.anchor.before{border:none}a.anchor.before:hover{background:transparent}a.anchor.before svg{fill:#fff}a.image-link,a.image-link:hover{border-bottom:none;border-top:none}a.image-link:hover{background:none}.primary-color{color:var(--primary)}.primary-underline{border-bottom:3px solid var(--primary)}.deemphasized{color:var(--dark-font-color)}.gatsby-resp-image-wrapper{margin-left:0!important}a.gatsby-resp-image-link{background:transparent!important;border-bottom:none!important;border-top:none!important}.highlighted{background:var(--primary);color:var(--reverse)}.not-found-image{margin:0 auto;width:400px}.flex{display:flex}.flex-align-center{align-items:center}.flex-header,.flex-justify-between{justify-content:space-between}.flex-header{align-items:center;display:flex}.flex-header a{font-size:1rem}.search-bar{grid-gap:1rem;align-items:center;display:grid;grid-template-columns:auto 50px}.search-icon{cursor:pointer}.search-input{-webkit-appearance:none;background:var(--input-background);border:1px solid transparent;border-radius:0;color:var(--bright-font-color);font-size:1.1rem;line-height:1.1;padding:.75rem 1rem;width:100%}.search-input:active,.search-input:focus,.search-input:hover{border-color:var(--primary)}.search-input:focus{box-shadow:1px 1px 1px var(--primary);-webkit-filter:brightness(1.1);filter:brightness(1.1);outline:none}::-webkit-scrollbar{background:var(--scrollbar);height:8px;width:8px}::-webkit-scrollbar-thumb{background:var(--scrollbar-track);border-radius:0}::selection{background:var(--primary);color:var(--reverse)}::-moz-selection{background:var(--primary);color:var(--reverse)}::marker{color:var(--primary)}.search-input::-webkit-search-cancel-button{color:var(--bright-font-color)}.collapsed main{margin-left:80px}.collapsed .file-header{left:80px;width:calc(100vw - 80px)}.collapsed .sidebar{display:none}.desktop-only{display:block!important}@media screen and (max-width:1000px){blockquote,ol,p,table,ul{font-size:1.05rem;margin:0 0 1.5rem}main{margin-left:0!important;margin-top:95px}.sidebar{display:none}.navbar{border-bottom:1px solid var(--light-border-color);box-shadow:1px 1px 2px rgba(0,0,0,.1);height:60px;left:0;top:35px;width:100%;z-index:9}.navbar img{max-width:30px}.navbar section{flex-direction:row}.navbar section nav{display:flex}.navbar a,.navbar button{border-left:none!important;border-right:none!important}.navbar a.active,.navbar a:focus,.navbar a:hover,.navbar button:focus-visible{background:var(--navbar-color);border-left:none!important;border-right:none!important}.navbar button:focus{border:3px solid transparent;border-left:none;border-right:none}.navbar a:hover .tooltip,.navbar button:hover .tooltip{display:none}.file-header{left:0!important;margin-top:0;width:100%!important}.file{background:var(--navbar-color)}.file,.file-header button span{font-size:1rem}button.colors,button.colors .colors-dropdown{width:100px}.projects{grid-gap:1rem;grid-template-columns:repeat(2,50%)}.project .stars{justify-content:center}.footer{height:auto;padding:1.5rem 0;position:static}.footer section{align-items:center;flex-direction:column;gap:1.25rem}.footer a,.footer span{line-height:1.2}.desktop-only{display:none!important}.hero h1{font-size:2.5rem}.hero p.subtitle{font-size:1.2rem}.container{padding:1.5rem}article h1{font-size:2.2rem;line-height:1.2}article header{padding-top:1rem}article .description{font-size:1.3rem}}.theme{background:var(--background-color);color:var(--font-color)}#resume header{text-align:left}#resume section h2,#resume section h3,#resume section h4,#resume section h5{margin-bottom:1rem;margin-top:0}#resume section h2{border-bottom:1px solid var(--light-border-color);font-size:1.1rem;margin-top:2.5rem;text-transform:uppercase}#resume section h3{align-items:center;display:flex;justify-content:space-between}#resume section h3 span{display:block;font-size:1rem;font-weight:400}#resume section h3{font-size:1.3rem;margin-bottom:.5rem}#resume section li,#resume section p{font-size:1rem;line-height:1.3}#resume section li{margin-bottom:.5rem}.divider{background:var(--primary);height:1px;margin-bottom:2rem;width:100%}:root{--code-font-color:#b3b9c5;--code-background-color:#333;--string:#92d192;--variable:#f2777a;--property:#abb2bf;--number:#fca369;--operator:#ac8d58;--punctuation:#d5d8df;--comment:#848991;--function:#62cfcf;--keyword:#ffeead;--attribute:#ffd479;--class:#e1a6f2;--tag:#6ab0f3;--error:#f2777a;--terminal-color:var(--code-font-color)}code[class*=language-],pre[class*=language-]{word-wrap:normal;color:var(--code-font-color);font-family:var(--code-font-family);font-size:.9rem!important;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{-webkit-font-smoothing:subpixel-antialiased;background:var(--code-background-color);font-family:Menlo,monospace;margin-bottom:2rem;margin-top:2rem;overflow:initial;padding:1rem}:not(pre)>code[class*=language-]{-webkit-font-smoothing:antialiased;background:var(--inline-code-background-color)!important;color:var(--inline-code-color)!important;font-size:1rem;font-weight:600;padding:2px 3px;white-space:pre-wrap}a:hover :not(pre)>code[class*=language-]{color:var(--black)}pre.language-text{background:transparent}pre.language-shell,pre.language-terminal,pre.language-text.line-numbers{padding-left:1.5rem!important}pre.language-shell .line-numbers-rows,pre.language-terminal .line-numbers-rows,pre.language-text .line-numbers-rows{display:none}code.language-text{background:var(--light-background)!important;box-shadow:none;color:var(--font-color)!important}pre.language-text code.language-text{border:none}code.language-shell:before{color:var(--comment);content:"$ "}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:4.5rem;position:relative}pre.language-terminal{-webkit-text-size-adjust:none;background:var(--reverse);border:1px solid var(--category-background-color);color:var(--font-color);margin:2rem 0;padding-top:3rem;position:relative;white-space:normal}code.language-terminal{-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:none;-moz-text-size-adjust:none;text-size-adjust:none;color:var(--terminal-color)}pre.language-terminal:before{background:var(--category-background-color);border-bottom:1px solid var(--light-border-color);color:var(--dark-font-color);content:"\2022 \2022 \2022";font-size:2.5rem;left:0;letter-spacing:-5px;line-height:0;margin:0;padding:15px 0 12px;position:absolute;text-indent:6px;top:0;width:100%}.line-numbers .line-numbers-rows{border-right:1px solid #444;font-size:100%;left:-3.8rem;letter-spacing:-1px;padding-right:.5rem;pointer-events:none;position:absolute;top:1rem!important;width:3rem!important}.line-numbers-rows>span:before{color:#777}.gatsby-highlight{-webkit-text-size-adjust:none;-moz-text-size-adjust:none;text-size-adjust:none;font-size:.9rem;margin:1.5rem -1.5rem;max-width:999999px;overflow-x:auto;overflow-y:hidden;padding-left:1.5rem}.gatsby-highlight pre[class*=language-]{float:left;margin-bottom:0;margin-top:0;min-width:calc(100% + 1.5rem)}.gatsby-highlight-code-line{background-color:#222;border-left:.25rem solid var(--primary);display:block;margin-left:-.75rem;margin-right:-1rem;padding-left:.5rem;padding-right:1.5rem}.filename{align-items:center;background:#222;color:#ccc;display:flex;font-size:.9rem;line-height:1;margin-bottom:-2rem;padding:.5rem 1.5rem}.token.cdata,.token.comment,.token.doctype,.token.important,.token.prolog{color:var(--comment)}.token.punctuation{color:var(--punctuation)}.token.namespace{opacity:.7}.token.property{color:var(--property)}.token.constant,.token.deleted,.token.symbol,.token.tag{color:var(--tag)}.token.number{color:var(--number)}.token.builtin,.token.char,.token.inserted,.token.url{color:var(--code-font-color)}.token.attr-name,.token.selector{color:var(--attribute)}.token.attr-value,.token.string{color:var(--string)}.token.operator{color:var(--operator)}.token.atrule,.token.keyword{color:var(--keyword)}.token.function{color:var(--function)}.language-css,.token.boolean,.token.class-name{color:var(--class)!important}.token.regex{color:var(--keyword)}.token.variable{color:var(--variable)}.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.language-jsx .token.class-name{color:var(--tag)!important}code::selection,pre::selection{background:hsla(0,0%,59%,.3)!important;color:inherit;text-shadow:none}code[class*=language-] ::selection,pre[class*=language-]::selection{background:hsla(0,0%,59%,.3)!important;color:inherit;text-shadow:none}.filename,pre[class*=language-]{margin-left:-1.5rem;margin-right:-1.5rem}pre[class*=language-].line-numbers{padding-left:3.5rem}pre[class*=language-]{margin-bottom:1.5rem;margin-top:1.5rem}.filename{margin-bottom:-1.5rem}@media screen and (min-width:1350px){.gatsby-highlight{margin-bottom:2rem}.filename{margin-top:2rem}.filename,.gatsby-highlight{margin-left:-3.5rem;margin-right:-3.5rem}pre.language-text.line-numbers{padding-left:3.5rem!important}}.light.theme{--heading-font-color:#222;--link-color:#111;--border-color:#bbb;--light-border-color:#d0d0d0;--background-color:#fff;--sidebar-color:#f0f0f0;--navbar-color:#ddd;--sidebar-color-hover:#dedede;--sidebar-color-focus:#fff;--category-background-color:#d5d5d5;--category-background-color-hover:silver;--toolbar-color:#333;--toolbar-background-color:#f0f0f0;--tooltip-border-color:#999;--tooltip-background-color:#f0f0f0;--font-color:#454545;--medium-font-color:#555;--dark-font-color:#888;--input-background:transparent;--bright-font-color:#222;--blockquote-background-color:rgba(0,0,0,0.02);--blockquote-color:#111;--inline-code-background-color:rgba(0,0,0,0.05);--inline-code-color:#111;--h2-filter:brightness(0.8);--h3-filter:brightness(0.9);--h4-filter:brightness(0.95);--icon-filter:brightness(0.8);--dark-opacity:rgba(0,0,0,0.05);--dark-opacity-hover:rgba(0,0,0,0.1);--reverse:#fff;--terminal-color:var(--bright-font-color);--scrollbar:#888;--scrollbar-track:#bbb}</style><meta name="generator" content="Gatsby 3.12.1"/><title data-react-helmet="true">Writing an Emulator in JavaScript (Chip-8) | Tania Rascia</title><meta data-react-helmet="true" name="description" content="I spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I&#x27;d write an emulator myself…"/><meta data-react-helmet="true" name="image" content="https://www.taniarascia.com/logo.png"/><meta data-react-helmet="true" property="og:url" content="https://www.taniarascia.com/writing-an-emulator-in-javascript-chip8/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Writing an Emulator in JavaScript (Chip-8)"/><meta data-react-helmet="true" property="og:description" content="I spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I&#x27;d write an emulator myself…"/><meta data-react-helmet="true" property="og:image" content="https://www.taniarascia.com/logo.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Writing an Emulator in JavaScript (Chip-8)"/><meta data-react-helmet="true" name="twitter:description" content="I spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I&#x27;d write an emulator myself…"/><meta data-react-helmet="true" name="twitter:image" content="https://www.taniarascia.com/logo.png"/><script data-react-helmet="true" type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","url":"https://www.taniarascia.com","name":"Writing an Emulator in JavaScript (Chip-8)","alternateName":"Writing an Emulator in JavaScript (Chip-8)"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https://www.taniarascia.com/writing-an-emulator-in-javascript-chip8/","name":"Writing an Emulator in JavaScript (Chip-8)","image":"https://www.taniarascia.com/logo.png"}}]},{"@context":"http://schema.org","@type":"BlogPosting","url":"https://www.taniarascia.com","name":"Writing an Emulator in JavaScript (Chip-8)","alternateName":"Writing an Emulator in JavaScript (Chip-8)","headline":"Writing an Emulator in JavaScript (Chip-8)","image":{"@type":"ImageObject","url":"https://www.taniarascia.com/logo.png"},"description":"I spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I'd write an emulator myself…"}]</script><link rel="icon" href="/favicon-32x32.png?v=07f5a193c5a1357203c0389b1002fb71" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#5183f5"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=07f5a193c5a1357203c0389b1002fb71"/><link rel="alternate" type="application/rss+xml" title="Tania Rascia | RSS Feed" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link as="script" rel="preload" href="/webpack-runtime-a0e74d583841f3e0a74a.js"/><link as="script" rel="preload" href="/framework-97155db9408cb0e3fcd4.js"/><link as="script" rel="preload" href="/app-2c67c096c1a7f0695165.js"/><link as="script" rel="preload" href="/commons-99325db68594412750ba.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-855d4395f6fd9edac223.js"/><link as="fetch" rel="preload" href="/page-data/writing-an-emulator-in-javascript-chip8/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/352937542.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><article><header><div class="container"><h1>Writing an Emulator in JavaScript (Chip-8)</h1><div class="post-meta"><div class="tags"><a class="tag-javascript" href="/tags/javascript">javascript</a><a class="tag-node" href="/tags/node">node</a><a class="tag-projects" href="/tags/projects">projects</a><a class="tag-games" href="/tags/games">games</a></div><div class="post-details">Written by <a href="/me">Tania Rascia</a> on<!-- --> <time>April 13, 2020</time></div></div></div></header><div id="/writing-an-emulator-in-javascript-chip8/" class="container"><p>I spent a good portion of my childhood playing emulated NES and SNES games on my computer, but I never imagined I'd write an emulator myself one day. However, <a href="https://sergeev.io/">Vanya Sergeev</a> challenged me to write a <a href="https://en.wikipedia.org/wiki/CHIP-8">Chip-8</a> interpreter to learn some of the basic concepts of lower-level programming languages and how a CPU works, and the end result is a Chip-8 emulator in JavaScript that I wrote with his guidance.</p>
<p>Although there are endless implementations of the Chip-8 interpreter in every programming language imaginable, this one is a bit unique. My Chip8.js code interfaces with not just one but three environments, existing as a web app, a CLI app, and a native app.</p>
<p>You can take a look at the web app demo and the source here:</p>
<ul>
<li><a href="https://taniarascia.github.io/chip8/">Demo</a></li>
<li><a href="https://github.com/taniarascia/chip8">Source code</a></li>
</ul>
<p>There are plenty of guides on how to make a Chip-8 emulator, such as <a href="http://mattmik.com/files/chip8/mastering/chip8.html">Mastering Chip8</a>, <a href="http://www.multigesture.net/articles/how-to-write-an-emulator-Chip-8-interpreter/">How to Write an Emulator</a>, and most importantly, <a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM">Cowgod's Chip-8 Technical Reference</a>, the primary resource used for my own emulator, and a website so old it ends in <code class="language-text">.HTM</code>. As such, this isn't intended to be a how-to guide, but an overview of how I built the emulator, what major concepts I learned, and some JavaScript specifics for making a browser, CLI, or native app.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/730748a3484c7822029e436f532694fb/00d43/blinky.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 95%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAEEUlEQVQ4y52US28TVxTHhzgN8djOPO698/TMeMYee+zYSUwghBBKEgpFEF5JIEQECiQqorSirfqQcFuxqNRFl5W6QOonGD4A2y77IfolWHjBSPdfzU1DrC470l9X59xzfuccHd2RulVbslRFZUypabrml0qlQFXVwHHswLKswDLNoFwuB7IsB5qmibtDaaoaTCmKX65UapVKRWWUStLzpiVFmvLKsSfhhf7b5eXl4cmFU8PpXnfY7XWHc/P9oV8LhhOTx4djhcKwkOuDwrAwXhiOjQn77fj4OCYmJl5Jh99sr/d6fr6PhYUFvri4hLlOHwtzp7F46gyWTpzBXGcODT+G79VQCyP4RoDAqcELQnSSNj97ch6tdvv1eyClNDUMA4yxd5RS7qzUeXUt5vZswL3rHe6uxUJGYHOqUe6tJ9xZrnNGGTcM451lmsgZ74G6rqfEoCCqnhnTLsKXi4h+OYv2m3XM/L2Dxm/n0fnzOrx7XdirdXT/2kD8xxqoxUAoyQijyBlHQFVL9bIGXVYzohFU73Tg7UzD2+2i9u1JsMiCvz+D6u02vIc9+I9nEDzrgyj6QU6eOwo0Qjv1riSoXkmy6noC92IT1Y9bcFcbcNfiA6004F5qijv3oybcCzHy2OrVJKteaoKa7Ajono9T9jgBfdrOtK0I2k4d6kYN7FkH+r0GzG9mYHzZhf1yHt7vy1A3QxGj78agT9oZ22uDRtYR0FmKUnIvxtQNPyuvOrB+6AtVLrkgey0h/WET5NNEwKyfTsAa9FE6Z0G9E2ZkNwYJjCNgdTVO6W4T6naUkf0WtO0I4typQ7lVg7oVQrnmi67V22HeFfT7sSiU59CHLdD6SIdmy00rSxaUzVqm3AhEYHnVhv4gFmO6v56GcjMQtv5JjMpFF/RJgjxW3Qqz8oIBzSQjwE41nVpxod6NsqkrnuhIVL8dik5zaD6mdrd+AH3UFAVE99tRVvnQhm6R0aU0UvqgBWWjluWj0M86ML7qgX0+jcoFRyxGjH8jgPndLNjzLsh+Iooqt4JMLDQ0R4Dn6indS6DvNzPtfgP6XhPqTgT6rA3j+1lUrnqorHtgX3cxdc2HiHncFCd5mmTkUQtkFGj3g9TcboFcizJ6s87prQZnWzH3f17kzheznG3GnG00uP2kJ/wsv99s8DyWXI8y804L1BvZsq7pKWUUzGLvqME4803OAosTSji1GDfqNmeuwSmjnIUWN0LrwM5jLfH+//P0iP6aEAIhnYD5JljNBAstGG0HRscBzX25Ekf4aNVA/kwP83Rdf/+3GZNl+XKpVPpRluUXckkeyMeLg+JEcSBPFAfF8clBsTApfMJ/aE8WByJWll/8m3s5Z0mGYeTQY5IkFSRJGv+fynOP5ax/AEjLr74HrbIkAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="blinky"
        title="blinky"
        src="/static/730748a3484c7822029e436f532694fb/5a190/blinky.png"
        srcset="/static/730748a3484c7822029e436f532694fb/772e8/blinky.png 200w,
/static/730748a3484c7822029e436f532694fb/e17e5/blinky.png 400w,
/static/730748a3484c7822029e436f532694fb/5a190/blinky.png 800w,
/static/730748a3484c7822029e436f532694fb/00d43/blinky.png 1000w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h4 id="contents" style="position:relative;"><a href="#contents" aria-label="contents permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Contents</h4>
<ul>
<li><a href="#what-is-chip-8">What is Chip-8</a></li>
<li><a href="#what-goes-into-a-chip-8-interpreter">What Goes Into a Chip-8 Interpreter?</a></li>
<li><a href="#decoding-chip-8-instructions">Decoding Chip-8 Instructions</a></li>
<li><a href="#reading-the-rom-data-buffer">Reading the ROM</a></li>
<li><a href="#the-instruction-cycle---fetch-decode-execute">The Instruction Cycle - Fetch, Decode, Execute</a></li>
<li><a href="#creating-a-cpu-interface-for-i-o">Creating a CPU Interface for I/O</a>
<ul>
<li><a href="#cli-app---interfacing-with-the-terminal">CLI App - Interfacing with the Terminal</a></li>
<li><a href="#web-app---interfacing-with-the-browser">Web App - Interfacing with the Browser</a></li>
<li><a href="#native-app---interfacing-with-the-native-platform">Native App - Interfacing with the Native Platform</a></li>
</ul>
</li>
</ul>
<h2 id="what-is-chip-8" style="position:relative;"><a href="#what-is-chip-8" aria-label="what is chip 8 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What is Chip-8?</h2>
<p>I had never heard of Chip-8 before embarking on this project, so I assume most people haven't either unless they're already into emulators. Chip-8 is a very simple interpreted programming language that was developed in the 1970s for hobbyist computers. People wrote basic Chip-8 programs that mimicked popular games of the time, such as Pong, Tetris, Space Invaders, and probably other unique games lost to the annuls of time.</p>
<p>A virtual machine that plays these games is actually a Chip-8 <a href="https://en.wikipedia.org/wiki/Interpreter_(computing)"><em>interpreter</em></a>, not technically an <a href="https://en.wikipedia.org/wiki/Emulator"><em>emulator</em></a>, as an emulator is software that emulates the hardware of a specific machine, and Chip-8 programs aren't tied to any hardware in specific. Often, Chip-8 interpreters were used on graphing calculators.</p>
<p>Nonetheless, it's close enough to being an emulator that it's usually the starting project for anyone who wants to learn how to build an emulator, since it's significantly more simple than creating an NES emulator or anything beyond that. It's also a good starting point for a lot of CPU concepts in general, like memory, stacks, and I/O, things I deal with on a daily basis in the infinitely more complex world of a JavaScript runtime.</p>
<h2 id="what-goes-into-a-chip-8-interpreter" style="position:relative;"><a href="#what-goes-into-a-chip-8-interpreter" aria-label="what goes into a chip 8 interpreter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What Goes Into a Chip-8 Interpreter?</h2>
<p>There was a lot of pre-learning I had to do to even get started understanding what I was working with, since I had never learned about computer science basics before. So I wrote <a href="https://www.taniarascia.com/bits-bytes-bases-and-a-hex-dump-javascript/">Understanding Bits, Bytes, Bases, and Writing a Hex Dump in JavaScript</a> which goes over much of that.</p>
<p>To summarize, there are two major takeaways of that article:</p>
<ul>
<li><strong>Bits and Bytes</strong> - A bit is a binary digit - <code class="language-text">0</code> or <code class="language-text">1</code>, <code class="language-text">true</code> or <code class="language-text">false</code>, on or off. Eight bits is a byte, which is the basic unit of information that computers work with.</li>
<li><strong>Number Bases</strong> - Decimal is the base number system we're most used to dealing with, but computers usually work with binary (base 2) or hexadecimal (base 16). <code class="language-text">1111</code> in binary, <code class="language-text">15</code> in decimal, and <code class="language-text">f</code> in hexadecimal are all the same number.</li>
<li><strong>Nibbles</strong> - Also, 4 bits is a nibble, which is cute, and I had to deal with them a bit in this project.</li>
<li><strong>Prefixes</strong> - In JavaScript, <code class="language-text">0x</code> is a prefix for a hex number, and <code class="language-text">0b</code> is a prefix for a binary number.</li>
</ul>
<p>I also wrote <a href="https://www.taniarascia.com/snake-game-in-javascript/">a CLI snake game</a> in preparation of figuring out how to work with pixels in the terminal for this project.</p>
<p>A <strong>CPU</strong> is the main processor of a computer that executes the instructions of a program. In this case, it consists of various bits of state, described below, and an instruction cycle with <strong>fetch, decode, and execute</strong> steps.</p>
<ul>
<li><a href="#memory">Memory</a></li>
<li><a href="#program-counter">Program counter</a></li>
<li><a href="#registers">Registers</a></li>
<li><a href="#index-register">Index register</a></li>
<li><a href="#stack">Stack</a></li>
<li><a href="#stack-pointer">Stack pointer</a></li>
<li><a href="#key-input">Key input</a></li>
<li><a href="#graphical-output">Graphical output</a></li>
<li><a href="#timers">Timers</a></li>
</ul>
<h3 id="memory" style="position:relative;"><a href="#memory" aria-label="memory permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Memory</h3>
<p>Chip-8 can access up to <strong>4 kilobytes of memory</strong> (RAM). (That's <code class="language-text">0.002%</code> of the storage space on a floppy disk.) The vast majority of data in the CPU is stored in memory.</p>
<p>4kb is <code class="language-text">4096</code> bytes, and JavaScript has some helpful <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays">typed arrays</a>, like <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Uint8Array">Uint8Array</a> which is a fixed-size array of a certain element - in this case 8-bits.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>You can access and use this array like a regular array, from <code class="language-text">memory[0]</code> to <code class="language-text">memory[4095]</code> and set each element to a value up to <code class="language-text">255</code>. Anything above that will fall back to that (for example, <code class="language-text">memory[0] = 300</code> would result in <code class="language-text">memory[0] === 255</code>).</p>
<h3 id="program-counter" style="position:relative;"><a href="#program-counter" aria-label="program counter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Program counter</h3>
<p>The program counter stores the address of the current instruction as an <strong>16-bit integer</strong>. Every single instruction in Chip-8 will update the program counter (PC) when it is done to go on to the next instruction, by accessing memory with PC as the index.</p>
<p>In the Chip-8 memory layout, <code class="language-text">0x000</code> to <code class="language-text">0x1FF</code> in memory is reserved, so it starts at <code class="language-text">0x200</code>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> <span class="token constant">PC</span> <span class="token operator">=</span> <span class="token number">0x200</span> <span class="token comment">// memory[PC] will access the address of  the current instruvtion</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p><small><em>*You'll notice the memory array is 8-bit and the PC is a 16-bit integer, so two program codes will be combined to make a big endian opcode.</em></small></p>
<h3 id="registers" style="position:relative;"><a href="#registers" aria-label="registers permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Registers</h3>
<p>Memory is generally used for long-term storage and program data, so registers exist as a kind of "short-term memory" for immediate data and computations. Chip-8 has <strong>16 8-bit registers</strong>. They're referred as <code class="language-text">V0</code> through <code class="language-text">VF</code>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> registers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3 id="index-register" style="position:relative;"><a href="#index-register" aria-label="index register permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Index register</h3>
<p>There is a special <strong>16-bit register</strong> that accesses a specific point in memory, referred to as <code class="language-text">I</code>. The <code class="language-text">I</code> register exists mostly for reading and writing to memory in general, since the addressable memory is 16-bit as well.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> <span class="token constant">I</span> <span class="token operator">=</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3 id="stack" style="position:relative;"><a href="#stack" aria-label="stack permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stack</h3>
<p>Chip-8 has the ability to go into <a href="https://en.wikipedia.org/wiki/Subroutine">subroutines</a>, and a stack for keeping track of where to return to. The stack is <strong>16 16-bit values</strong>, meaning the program can go into 16 nested subroutines before experiencing a "stack overflow".</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h3 id="stack-pointer" style="position:relative;"><a href="#stack-pointer" aria-label="stack pointer permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stack pointer</h3>
<p>The stack pointer (SP) is an <code class="language-text">8-bit</code> integer that points to a location in the stack. It only needs to be 8-bit even though the stack is 16-bit because it's only referencing the index of the stack, so only needs to be <code class="language-text">0</code> thorough <code class="language-text">15</code>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> <span class="token constant">SP</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token comment">// stack[SP] will access the current return address in the stack</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<h3 id="timers" style="position:relative;"><a href="#timers" aria-label="timers permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Timers</h3>
<p>Chip-8 is capable of a glorious single beep as far as sound goes. To be honest, I didn't bother implementing an actual output for the "music", though the CPU itself is all set up to interface properly with it. There are two timers, both <strong>8-bit registers</strong> - a sound timer (ST) for deciding when to beep and a delay timer (DT) for timing some events throughout the game. They count down at <strong>60 Hz</strong>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> <span class="token constant">DT</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">let</span> <span class="token constant">ST</span> <span class="token operator">=</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span></span></pre></div>
<h3 id="key-input" style="position:relative;"><a href="#key-input" aria-label="key input permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Key input</h3>
<p>Chip-8 was set up to interface with the amazing hex keyboard. It looked like this:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">┌───┬───┬───┬───┐
│ 1 │ 2 │ 3 │ C │
│ 4 │ 5 │ 6 │ D │
│ 7 │ 8 │ 9 │ E │
│ A │ 0 │ B │ F │
└───┴───┴───┴───┘</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>In practice, only a few of the keys seem to be used, and you can map them to whatever 4x4 grid you want, but they're pretty inconsistent between games.</p>
<h3 id="graphical-output" style="position:relative;"><a href="#graphical-output" aria-label="graphical output permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Graphical output</h3>
<p>Chip-8 uses a monochromatic <code class="language-text">64x32</code> resolution display. Each pixel is either on or off.</p>
<p>Sprites that can be saved in memory are <code class="language-text">8x15</code> - eight pixels wide by fifteen pixels high. Chip-8 also comes with a font set, but it only contains the characters in the hex keyboard, so not overall the most useful font set.</p>
<h3 id="cpu" style="position:relative;"><a href="#cpu" aria-label="cpu permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CPU</h3>
<p>Put it all together, and you get the CPU state.</p>
<div class="filename">CPU</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">CPU</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>registers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">ST</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">DT</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">I</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">SP</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">=</span> <span class="token number">0x200</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2 id="decoding-chip-8-instructions" style="position:relative;"><a href="#decoding-chip-8-instructions" aria-label="decoding chip 8 instructions permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Decoding Chip-8 Instructions</h2>
<p>Chip-8 has 36 instructions. All the instructions <a href="http://devernay.free.fr/hacks/chip8/C8TECH10.HTM#3.1">are listed here</a>. All instructions are 2 bytes (16-bits) long. Each instruction is encoded by an opcode (operation code) and operand, the data being operated on.</p>
<p>An example of an instruction could be like this operation on two variables:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">x = 1
y = 2

ADD x, y</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>In which <code class="language-text">ADD</code> is the <code class="language-text">opcode</code> and <code class="language-text">x</code>, <code class="language-text">y</code> are the operands. This type of language is known as an assembly language. This instruction would map to:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">x <span class="token operator">=</span> x <span class="token operator">+</span> y</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>With this instruction set I'll have to store this data in 16-bits, so every instrution ends up being a number from <code class="language-text">0x0000</code> to <code class="language-text">0xffff</code>. Each digit position in these sets is a nibble (4-bit).</p>
<p>So how can I get from <code class="language-text">nnnn</code> to something like <code class="language-text">ADD x, y</code>, that is a little more understandable? Well, I'll start by looking at one of the instructions from Chip-8, which is basically the same as the above example:</p>
<table>
<thead>
<tr>
<th>Instruction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code class="language-text">8xy4</code></td>
<td><code class="language-text">ADD Vx, Vy</code></td>
</tr>
</tbody>
</table>
<p>So what are we dealing with here? There's one keyword, <code class="language-text">ADD</code>, and two arguments, <code class="language-text">Vx</code> and <code class="language-text">Vy</code>, which we've established above are registers.</p>
<p>There are several opcode mnemonics (which are like keywords), such as:</p>
<ul>
<li><code class="language-text">ADD</code> (add)</li>
<li><code class="language-text">SUB</code> (subtract)</li>
<li><code class="language-text">JP</code> (jump)</li>
<li><code class="language-text">SKP</code> (skip)</li>
<li><code class="language-text">RET</code> (return)</li>
<li><code class="language-text">LD</code> (load)</li>
</ul>
<p>And there are several type of operand values, such as:</p>
<ul>
<li>Address (<code class="language-text">I</code>)</li>
<li>Register (<code class="language-text">Vx</code>, <code class="language-text">Vy</code>)</li>
<li>Constant (<code class="language-text">N</code> or <code class="language-text">NN</code> for nibble or byte)</li>
</ul>
<p>The next step is to find a way to interpret the 16-bit opcode as these more understandable instructions.</p>
<h3 id="bit-masking" style="position:relative;"><a href="#bit-masking" aria-label="bit masking permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bit Masking</h3>
<p>Each instruction contains a pattern that will always be the same, and variables that can change. For <code class="language-text">8xy4</code>, the pattern is <code class="language-text">8__4</code>. The two nibbles in the middle are the variables. By creating a <a href="https://en.wikipedia.org/wiki/Mask_(computing)">bitmask</a> for that pattern, I can determine the instruction.</p>
<p>To mask, you use the bitwise AND (<code class="language-text">&amp;</code>) with a mask and match it to a pattern. So if the instruction <code class="language-text">8124</code> came up, you would want to make sure the nibble in position 1 and 4 are on (passed through) and the nibble in position 2 and 3 are off (masked out). The mask then becomes <code class="language-text">f00f</code>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> opcode <span class="token operator">=</span> <span class="token number">0x8124</span>
<span class="token keyword">const</span> mask <span class="token operator">=</span> <span class="token number">0xf00f</span>
<span class="token keyword">const</span> pattern <span class="token operator">=</span> <span class="token number">0x8004</span>

<span class="token keyword">const</span> isMatch <span class="token operator">=</span> <span class="token punctuation">(</span>opcode <span class="token operator">&amp;</span> mask<span class="token punctuation">)</span> <span class="token operator">===</span> pattern <span class="token comment">// true</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">  8124
&amp; f00f
  ====
  8004</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>Similarly, <code class="language-text">0f00</code> and <code class="language-text">00f0</code> will mask the variables, and right-shifting (<code class="language-text">>></code>) them will access the correct nibble.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x8124</span> <span class="token operator">&amp;</span> <span class="token number">0x0f00</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">8</span> <span class="token comment">// 1</span>

<span class="token comment">// (0x8124 &amp; 0x0f00) is 100000000 in binary</span>
<span class="token comment">// right shifting by 8 (>> 8) will remove 8 zeroes from the right</span>
<span class="token comment">// This leaves us with 1</span>

<span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x8124</span> <span class="token operator">&amp;</span> <span class="token number">0x00f0</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">4</span> <span class="token comment">// 2</span>
<span class="token comment">// (0x8124 &amp; 0x00f0) is 100000 in binary</span>
<span class="token comment">// right shifting by 4 (>> 4) will remove 4 zeroes from the right</span>
<span class="token comment">// This leaves us with 10, the binary equivalent of 2</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>So for each of the 36 instructions, I made an object with a unique identifier, mask, pattern, and arguments.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> instruction <span class="token operator">=</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token string">'ADD_VX_VY'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'ADD'</span><span class="token punctuation">,</span>
  mask<span class="token operator">:</span> <span class="token number">0xf00f</span><span class="token punctuation">,</span>
  pattern<span class="token operator">:</span> <span class="token number">0x8004</span><span class="token punctuation">,</span>
  arguments<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> mask<span class="token operator">:</span> <span class="token number">0x0f00</span><span class="token punctuation">,</span> shift<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'R'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> mask<span class="token operator">:</span> <span class="token number">0x00f0</span><span class="token punctuation">,</span> shift<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> type<span class="token operator">:</span> <span class="token string">'R'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Now that I have these objects, each opcode can be disassembled into a unique identifier, and the values of the arguments can be determined. I made an <code class="language-text">INSTRUCTION_SET</code> array containing all these instructions and a disassembler. I also wrote <a href="https://github.com/taniarascia/chip8/blob/master/tests/cpu.test.js">tests for every one</a> to ensure they all worked correctly.</p>
<div class="filename">Disassembler</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">function</span> <span class="token function">disassemble</span><span class="token punctuation">(</span><span class="token parameter">opcode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Find the instruction from the opcode</span>
  <span class="token keyword">const</span> instruction <span class="token operator">=</span> <span class="token constant">INSTRUCTION_SET</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">instruction</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>opcode <span class="token operator">&amp;</span> instruction<span class="token punctuation">.</span>mask<span class="token punctuation">)</span> <span class="token operator">===</span> instruction<span class="token punctuation">.</span>pattern
  <span class="token punctuation">)</span>
  <span class="token comment">// Find the argument(s)</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> instruction<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>opcode <span class="token operator">&amp;</span> arg<span class="token punctuation">.</span>mask<span class="token punctuation">)</span> <span class="token operator">>></span> arg<span class="token punctuation">.</span>shift
  <span class="token punctuation">)</span>

  <span class="token comment">// Return an object containing the instruction data and arguments</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> instruction<span class="token punctuation">,</span> args <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h2 id="reading-the-rom" style="position:relative;"><a href="#reading-the-rom" aria-label="reading the rom permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reading the ROM</h2>
<p>Since we're considering this project an emulator, each Chip-8 program file can be considered a ROM. The ROM is just binary data, and we're writing the program to interpret it. We can imagine the Chip8 CPU to be a virtual console, and a Chip-8 ROM to be a virtual game cartridge.</p>
<p>The ROM buffer will take the raw binary file and translate it into 16-bit big endian words (a word is a unit of data consisting of a set amount of bits). This is where that <a href="/bits-bytes-bases-and-a-hex-dump-javascript/">hex dump article</a> comes in handy. I'm collecting the binary data and converting it into blocks that I can use, in this case the 16-bit opcodes. Big endian means that the most significant byte will be first in the buffer, so when it encounters the two bytes <code class="language-text">12 34</code>, it will create a <code class="language-text">1234</code> 16-bit code. A little endian code would look like <code class="language-text">3412</code>.</p>
<div class="filename">RomBuffer.js</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">RomBuffer</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * @param {binary} fileContents ROM binary
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fileContents</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment">// Read the raw data buffer from the file</span>
    <span class="token keyword">const</span> buffer <span class="token operator">=</span> fileContents

    <span class="token comment">// Create 16-bit big endian opcodes from the buffer</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The data returned from this buffer is the "game".</p>
<p>The CPU will have a <code class="language-text">load()</code> method - like loading a cartridge into a console - that will take the data from this buffer and place it into memory. Both the buffer and memory act as arrays in JavaScript, so loading the memory is just a matter of looping through the buffer and placing the bytes into the memory array.</p>
<h2 id="the-instruction-cycle---fetch-decode-execute" style="position:relative;"><a href="#the-instruction-cycle---fetch-decode-execute" aria-label="the instruction cycle   fetch decode execute permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The Instruction Cycle - Fetch, Decode, Execute</h2>
<p>Now I have the instruction set and game data all ready to be interpreted. The CPU just needs to do something with it. The <a href="https://en.wikipedia.org/wiki/Central_processing_unit#Operation">instruction cycle</a> consists of three steps - fetch, decode, and execute.</p>
<ul>
<li><strong>Fetch</strong> - Get the data stored in memory using the program counter</li>
<li><strong>Decode</strong> - Disassemble the 16-bit opcode to get the decoded instruction and argument values</li>
<li><strong>Execute</strong> - Perform the operation based on the decoded instruction and update the program counter</li>
</ul>
<p>Here's a condensed and simplified version of how load, fetch, decode, and execute work in the code. These CPU cycle methods are private and not exposed.</p>
<p>The first step, <code class="language-text">fetch</code>, will access the current opcode from memory.</p>
<div class="filename">Fetch</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Get address value from memory</span>
<span class="token keyword">function</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> memory<span class="token punctuation">[</span><span class="token constant">PC</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>The next step, <code class="language-text">decode</code>, will disassemble the opcode into the more understandable instruction set I created earlier.</p>
<div class="filename">Decode</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Decode instruction</span>
<span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token parameter">opcode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">disassemble</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>The last step, <code class="language-text">execute</code>, will consist of a switch with all 36 instructions as cases, and perform the relevant operation for the one it finds, then update the program counter so the next fetch cycle finds the next opcode. Any error handling will go here as well, which will halt the CPU.</p>
<div class="filename">Execute</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Execute instruction</span>
<span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token parameter">instruction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> args <span class="token punctuation">}</span> <span class="token operator">=</span> instruction

  <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">'ADD_VX_VY'</span><span class="token operator">:</span>
      <span class="token comment">// Perform the instruction operation</span>
      registers<span class="token punctuation">[</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> registers<span class="token punctuation">[</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

      <span class="token comment">// Update program counter to next instruction</span>
      <span class="token constant">PC</span> <span class="token operator">=</span> <span class="token constant">PC</span> <span class="token operator">+</span> <span class="token number">2</span>
      <span class="token keyword">break</span>
    <span class="token keyword">case</span> <span class="token string">'SUB_VX_VY'</span><span class="token operator">:</span>
    <span class="token comment">// etc...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>What I end up with is the CPU, with all the state and the instruction cycle. There are two methods exposed on the CPU - <code class="language-text">load</code>, which is the equivalent of loading a cartridge into a console with the <code class="language-text">romBuffer</code> as the game, and <code class="language-text">step</code>, which is the three functions of the instruction cycle (fetch, decode, execute). <code class="language-text">step</code> will run in an infinite loop.</p>
<div class="filename">CPU.js</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">CPU</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>memory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>registers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint16Array</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">ST</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">DT</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">I</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">SP</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">=</span> <span class="token number">0x200</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Load buffer into memory</span>
  <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">romBuffer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    romBuffer<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">opcode<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>memory<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> opcode
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Step through each instruction</span>
  <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> opcode <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> instruction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_decode</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_execute</span><span class="token punctuation">(</span>instruction<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">_fetch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memory<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PC</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token function">_decode</span><span class="token punctuation">(</span><span class="token parameter">opcode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">disassemble</span><span class="token punctuation">(</span>opcode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">_execute</span><span class="token punctuation">(</span><span class="token parameter">instruction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> args <span class="token punctuation">}</span> <span class="token operator">=</span> instruction

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'ADD_VX_VY'</span><span class="token operator">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>registers<span class="token punctuation">[</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registers<span class="token punctuation">[</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">PC</span> <span class="token operator">+</span> <span class="token number">2</span>
        <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Only one aspect of the project is missing now, and a pretty important one - the ability to actually play and see the game.</p>
<h2 id="creating-a-cpu-interface-for-io" style="position:relative;"><a href="#creating-a-cpu-interface-for-io" aria-label="creating a cpu interface for io permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating a CPU Interface for I/O</h2>
<p>So now I have this CPU that's interpreting and executing instructions and updating all its own state, but I can't do anything with it yet. In order to play a game, you have to see it and be able to interact with it.</p>
<p>This is where <a href="https://en.wikipedia.org/wiki/Input/output">input/output</a>, or I/O, comes in. I/O is the communication between the CPU and the outside world.</p>
<ul>
<li><strong>Input</strong> is data received by the CPU</li>
<li><strong>Output</strong> is data sent from the CPU</li>
</ul>
<p>So for me, the input will be through the keyboard, and the output will be graphics onto the screen.</p>
<p>I could just mix the I/O code in with the CPU directly, but then I would be tied to one environment. By creating a generic CPU interface to connect the I/O and the CPU, I can interface with any system.</p>
<p>The first thing to do was look through the instructions and find any that have to do with I/O. A few examples of those instructions:</p>
<ul>
<li><code class="language-text">CLS</code> - Clear the screen</li>
<li><code class="language-text">LD Vx, K</code> - Wait for a key press, store the value of the key in Vx.</li>
<li><code class="language-text">DRW Vx, Vy, nibble</code> - Display n-byte sprite starting at memory location I</li>
</ul>
<p>Based on that, we'll want the interface to have methods like:</p>
<ul>
<li><code class="language-text">clearDisplay()</code></li>
<li><code class="language-text">waitKey()</code></li>
<li><code class="language-text">drawPixel()</code> (<code class="language-text">drawSprite</code> would have been 1:1, but it ended up to be easier doing it pixel-by-pixel from the interface)</li>
</ul>
<p>JavaScript doesn't really have a concept of an abstract class as far as I could find, but I created one by making a class that could not itself be instantiated, with methods that can only be used from classes that extend it. Here are all the interface methods on the class:</p>
<div class="filename">CpuInterface.js</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Abstract CPU interface class</span>
<span class="token keyword">class</span> <span class="token class-name">CpuInterface</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> CpuInterface<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Cannot instantiate abstract class'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">clearDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Must be implemented on the inherited class.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Must be implemented on the inherited class.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Must be implemented on the inherited class.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">drawPixel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Must be implemented on the inherited class.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">enableSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Must be implemented on the inherited class.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">disableSound</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Must be implemented on the inherited class.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Here's how it will work: the interface will be loaded into the CPU on initialization, and the CPU will be able to access methods on the interface.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">CPU</span> <span class="token punctuation">{</span>
  <span class="token comment">// Initialize the interface</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">cpuInterface</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>interface <span class="token operator">=</span> cpuInterface
  <span class="token punctuation">}</span>

  <span class="token function">_execute</span><span class="token punctuation">(</span><span class="token parameter">instruction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> args <span class="token punctuation">}</span> <span class="token operator">=</span> instruction

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'CLS'</span><span class="token operator">:</span>
        <span class="token comment">// Use the interface while executing an instruction</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>interface<span class="token punctuation">.</span><span class="token function">clearDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Before setting up the interface with any real environment (web, terminal, or native) I created a mock interface for tests. It doesn't actually hook up to any I/O but it helped me to set up the state of the interface and prepare it for real data. I'll ignore the sound ones, because that was never implemented with actual speaker output, so that leaves the keyboard and screen.</p>
<h3 id="screen" style="position:relative;"><a href="#screen" aria-label="screen permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Screen</h3>
<p>The screen has a resolution of 64 pixels wide by 32 pixels tall. So as far as the CPU and interface is concerned, its a 64x32 grid of bits that are either on or off. To set up an empty screen, I can just make a 3D array of zeroes to represent all pixels being off. A <a href="https://en.wikipedia.org/wiki/Framebuffer">frame buffer</a> is a portion of memory containing a bitmapped image that will be rendered to a display.</p>
<div class="filename">MockCpuInterface.js</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Interface for testing</span>
<span class="token keyword">class</span> <span class="token class-name">MockCpuInterface</span> <span class="token keyword">extends</span> <span class="token class-name">CpuInterface</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Store the screen data in the frame buffer</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>frameBuffer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createFrameBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Create 3D array of zeroes</span>
  <span class="token function">createFrameBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> frameBuffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">32</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      frameBuffer<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">64</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        frameBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> frameBuffer
  <span class="token punctuation">}</span>

  <span class="token comment">// Update a single pixel with a value (0 or 1)</span>
  <span class="token function">drawPixel</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>frameBuffer<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>So I end up with something like this to represent the screen (when printing it as a newline-separated string):</p>
<div class="gatsby-highlight" data-language="terminal"><pre style="counter-reset: linenumber NaN" class="language-terminal line-numbers"><code class="language-terminal">0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000
...etc...</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>In the <code class="language-text">DRW</code> function, the CPU will loop through the sprite it pulled from memory and update each pixel in the sprite (some details left out for brevity).</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">case</span> <span class="token string">'DRW_VX_VY_N'</span><span class="token operator">:</span>
  <span class="token comment">// The interpreter reads n bytes from memory, starting at the address stored in I</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> line <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>memory<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">I</span> <span class="token operator">+</span> i<span class="token punctuation">]</span>
      <span class="token comment">// Each byte is a line of eight pixels</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> position <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> position<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...Get value, x, and y...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>interface<span class="token punctuation">.</span><span class="token function">drawPixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The <code class="language-text">clearDisplay()</code> function is the only other method that will be used for interacting with the screen. This is all the CPU interface needs for interacting with the screen.</p>
<h3 id="keys" style="position:relative;"><a href="#keys" aria-label="keys permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keys</h3>
<p>For keys, I mapped the original hex keyboard to the following 4x4 grid of keys:</p>
<div class="gatsby-highlight" data-language="text"><pre style="counter-reset: linenumber NaN" class="language-text line-numbers"><code class="language-text">┌───┬───┬───┬───┐
│ 1 │ 2 │ 3 │ 4 │
│ Q │ W │ E │ R │
│ A │ S │ D │ F │
│ Z │ X │ C │ V │
└───┴───┴───┴───┘</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>I put the keys in an array.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// prettier-ignore</span>
<span class="token keyword">const</span> keyMap <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
  <span class="token string">'q'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> 
  <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">,</span> 
  <span class="token string">'z'</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'v'</span>
<span class="token punctuation">]</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>And create some state to store the currently pressed keys.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token number">0</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>In the interface, <code class="language-text">keys</code> is a binary number consisting of 16 digits where each index represents a key. Chip-8 just wants to know at any given time which keys are pressed out of the 16 and makes a decision based on that. A few examples below:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token number">0b1000000000000000</span> <span class="token comment">// V is pressed (keyMap[15], or index 15)</span>
<span class="token number">0b0000000000000011</span> <span class="token comment">// 1 and 2 are pressed (index 0, 1)</span>
<span class="token number">0b0000000000110000</span> <span class="token comment">// Q and W are pressed (index 4, 5)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>Now if, for example, <code class="language-text">V</code> is pressed (<code class="language-text">keyMap[15]</code>) and the operand is <code class="language-text">0xf</code> (decimal <code class="language-text">15</code>), the key is pressed. Left shifting (<code class="language-text">&lt;&lt;</code>) with <code class="language-text">1</code> will create a binary number with a <code class="language-text">1</code> followed by as many zeroes as are in the left shift.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">case</span> <span class="token string">'SKP_VX'</span><span class="token operator">:</span>
  <span class="token comment">// Skip next instruction if key with the value of Vx is pressed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interface<span class="token punctuation">.</span><span class="token function">getKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registers<span class="token punctuation">[</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// Skip instruction</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Go to next instruction</span>
  <span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>There is one other key method, <code class="language-text">waitKey</code>, where the instruction is to wait for a keypress and return the key once pressed.</p>
<h2 id="cli-app---interfacing-with-the-terminal" style="position:relative;"><a href="#cli-app---interfacing-with-the-terminal" aria-label="cli app   interfacing with the terminal permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>CLI App - Interfacing with the Terminal</h2>
<p>The first interface I made was for the terminal. This was less familiar to me than working with the DOM as I have never made any sort of graphical app in terminal, but it wasn't too difficult.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f57d15af66cf51027de833838ebcd23d/00d43/terminalpong.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACaklEQVQ4y6WSTU8TURSGD3EK6xtjtEznnjtTQcZGKO0UlFI0LVIo8qEkBFbUhRI0IUxxYuICu3Ghm5aVgaUYlv4skvkDEMHpMWdaPgokapzkzZ1zZt5n3jn3Am158GN+rmv307iYfZsXpcKkmF0oiTF9RDyA+6JUmhBrq6/E2pvXojhWEHFAUcyNi2czk2J6qhhqbmZazM2Uut5V1gE+LC7A0+SAN1lIHWVygwdOOu2nkyl/ZOqRn3/5xHdSKT83mvVHs1k/89DxJ9xxf2gkE/YzTtp3nPRBxkkfJQf6vYUXzwGWVsoQ1fVtQyJJiYQKybhjkF2waexLjlRckWFIMmIGmX0m5XfyZCUskjFJiHgmXde3y+UywHvPA13Xa6apSCk8VpYKjFtGkFpJBdmtbIAxDJRSARoYWLYV5L/mg3giHtbcV0odK6UYWPM8D8B1XQbWuYmIJ8pUDdktqe9xHyWXkoQGUvhMIpk9Jg27w2Tds8JaKdUIPU1gnVlQqVTagIjY4HupSzJuG9Tqn62xm7FTGNdtQGaBu3EpYfOrpHgEVjuMV+5dqNsTbrgAm95mE2ieAy+nugI9V6M1pmZCrwKwG+yAOWjWE8UEyagMZ3hquJjqGhiF847KE/Yyg1mwR3sQH4rX++f7+bi0AyWGG9A73EsYux7IHvYyY4++AXxvAmsXga1hN1ob1Gj92hVdAtY4HFT3qyDvyu2eZA8fkV9XUvxB7GEvM6r7HwHWV9ehO9r9mc8bIh4i4s9/1CF7mcEsvjq0iGZ3dnUuapq2rEW05XD9G7XeDb0RzWYW2LYdQgHgxn+qg1m/AfZaZrz49WKGAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="terminalpong"
        title="terminalpong"
        src="/static/f57d15af66cf51027de833838ebcd23d/5a190/terminalpong.png"
        srcset="/static/f57d15af66cf51027de833838ebcd23d/772e8/terminalpong.png 200w,
/static/f57d15af66cf51027de833838ebcd23d/e17e5/terminalpong.png 400w,
/static/f57d15af66cf51027de833838ebcd23d/5a190/terminalpong.png 800w,
/static/f57d15af66cf51027de833838ebcd23d/00d43/terminalpong.png 1000w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p><a href="https://en.wikipedia.org/wiki/Curses_(programming_library)">Curses</a> is a library used to create text user interfaces in the terminal. <a href="https://github.com/chjj/blessed">Blessed</a> is a library wrapping curses for Node.js.</p>
<h3 id="screen-1" style="position:relative;"><a href="#screen-1" aria-label="screen 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Screen</h3>
<p>The frame buffer that contains the bitmap of the screen data is the same for all implementations, but the way the screen interfaces with each environment will be different.</p>
<p>With <code class="language-text">blessed</code>, I just defined a screen object:</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>screen <span class="token operator">=</span> blessed<span class="token punctuation">.</span><span class="token function">screen</span><span class="token punctuation">(</span><span class="token punctuation">{</span> smartCSR<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<p>And used <code class="language-text">fillRegion</code> or <code class="language-text">clearRegion</code> on the pixel with a full unicode block to fill it out, using the frameBuffer as the data source.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">drawPixel</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>frameBuffer<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> value

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>frameBuffer<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span><span class="token function">fillRegion</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>color<span class="token punctuation">,</span> <span class="token string">'█'</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span><span class="token function">clearRegion</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="keys-1" style="position:relative;"><a href="#keys-1" aria-label="keys 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keys</h3>
<p>The key handler was not too different from what I would expect with the DOM. If a key is pressed, the handler passes the key along, which I can then use to find the index and update the keys object with any new additional keys that have been pressed.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'keypress'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keyIndex <span class="token operator">=</span> keyMap<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span>full<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>keyIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setKeys</span><span class="token punctuation">(</span>keyIndex<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The only particularly weird thing was that <code class="language-text">blessed</code> didn't have a any keyup event that I could use, so I had to just simulate one by setting an interval that would periodically clear the keys.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Emulate a keyup event to clear all pressed keys</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_resetKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="entrypoint" style="position:relative;"><a href="#entrypoint" aria-label="entrypoint permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Entrypoint</h3>
<p>Everything is set up now - the rom buffer to convert the binary data to opcodes, the interface to connect I/O, the CPU containing state, the instruction cycle, and two exposed methods - one to load the game, and one to step through a cycle. So I create a <code class="language-text">cycle</code> function which will run the CPU instructions in an infinite loop.</p>
<div class="filename">terminal.js</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">CPU</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../classes/CPU'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> RomBuffer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../classes/RomBuffer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span>
  TerminalCpuInterface<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../classes/interfaces/TerminalCpuInterface'</span><span class="token punctuation">)</span>

<span class="token comment">// Retrieve the ROM file</span>
<span class="token keyword">const</span> fileContents <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// Initialize the terminal interface</span>
<span class="token keyword">const</span> cpuInterface <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TerminalCpuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Initialize the CPU with the interface</span>
<span class="token keyword">const</span> cpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CPU</span><span class="token punctuation">(</span>cpuInterface<span class="token punctuation">)</span>

<span class="token comment">// Convert the binary code into opcodes</span>
<span class="token keyword">const</span> romBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RomBuffer</span><span class="token punctuation">(</span>fileContents<span class="token punctuation">)</span>

<span class="token comment">// Load the game</span>
cpu<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>romBuffer<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">cycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cpu<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span>cycle<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">cycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><small><em>There is also a delay timer in the cycle function, but I removed it from the example for clarity.</em></small></p>
<p>Now I can run a script of the terminal entrypoint file and pass a ROM as the argument to play the game.</p>
<div class="gatsby-highlight" data-language="shell"><pre style="counter-reset: linenumber NaN" class="language-shell line-numbers"><code class="language-shell"><span class="command-line-prompt"><span data-user=root data-host=localhost></span></span><span class="token function">npm</span> run play:terminal roms/PONG</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span></span></pre></div>
<h2 id="web-app---interfacing-with-the-browser" style="position:relative;"><a href="#web-app---interfacing-with-the-browser" aria-label="web app   interfacing with the browser permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web App - Interfacing with the Browser</h2>
<p>The next interface I made was for the web, communicating with the browser and the DOM. I made this version of the emulator a bit more fancy, since the browser is more of my familiar environment and I can't resist the urge to make retro looking websites. This one also allows you to switch between games.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/294421a421911249839e41881b9c3975/c1b63/webpong.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 65.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACeklEQVQ4y32SzU7bQBDHdzdA4sRfO7O7/gomiSBJYwq0iICEeqk49tRbDxwsLu1LVH2SnvpeHIn6AiGSs1PZBJpKFYffzn/knZ9GWjPN/a50xW3/IL07Lo7L4WhYTiaTMs7iku3ystXZKYXTKkW7VQrBn/KOKDnnDYLzkjF2xxi7ddrtLstNNi2mIzp7f0rX1x9oPr+ki/mcjkZjgq4kdICwA4RdIKVMk5XUpIwhpZ/oZxkdDgcEWk+ZRJjFSbqMotgaY6o4SSoDukrOB9Xgy0k1LM+q0bfzJsd5Wg2/nlfpu0EVoamiJK6iOK7SNLFZli6lhBkL/GAGAI+IQIholVYWXWnTm0M7/H5pxz8/2tGPqyZnn6d28uvGZp/GFpzQooQGkEBSyscgCGasPhBxpZQiCdJ6vkdez6MwAlKnGXntHrncIX2xT/oqJ6/rkuf7BAbJzDJSubEq0aQSvQo8/69QG01Ou2MZY1TDOy3aG3r03LdnIe3m7kvvhi7Fp/ukJ4nVhzGpvlkFjrclREVuHFjWYi9DL/CtLHhTe26PkpOczDS1ZpKS7puVv+duhApXSiIFU21Zm/9fxP/ta2H8JiO1bywGQAi4CmS4taHW5HQcu73FazTCt/ukDiKrEKleavtRlrWw63Qrxtma74o1Y+xVXNddR3m8VpmpsBYiLhthGIYFIq7rV64/SCkJQtm8IvY1YaoIc0MQK8JME+aaAJpfjBQqUoC0mV2HQVgw3/ePAOAeAH4DwAMiLgBggRoXmKgFpnqhBuYpZ3qhDszi+c6Gh83sfe1ijLE9IcRYCHEshCg45wWvK+MFZ6yBbdUmc17Ud7eoZ8e16w9MJwRRUPGpmQAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="webpong"
        title="webpong"
        src="/static/294421a421911249839e41881b9c3975/5a190/webpong.png"
        srcset="/static/294421a421911249839e41881b9c3975/772e8/webpong.png 200w,
/static/294421a421911249839e41881b9c3975/e17e5/webpong.png 400w,
/static/294421a421911249839e41881b9c3975/5a190/webpong.png 800w,
/static/294421a421911249839e41881b9c3975/c1b63/webpong.png 1200w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h3 id="screen-2" style="position:relative;"><a href="#screen-2" aria-label="screen 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Screen</h3>
<p>For the screen, I used the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">Canvas API</a>, which uses <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D">CanvasRenderingContext2D</a> for the drawing surface. Using <code class="language-text">fillRect</code> with canvas was basically the same as <code class="language-text">fillRegion</code> in blessed.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>screen <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'black'</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span></span></pre></div>
<p>One slight difference I made here is I multiplied all the pixels by 10 so the screen would be more visible.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">this</span><span class="token punctuation">.</span>multiplier <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token constant">DISPLAY_WIDTH</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier
<span class="token keyword">this</span><span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token constant">DISPLAY_HEIGHT</span> <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span></span></pre></div>
<p>This made the <code class="language-text">drawPixel</code> command more verbose, but otherwise the same concept.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">drawPixel</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>frameBuffer<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^=</span> value

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>frameBuffer<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token constant">COLOR</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>
      x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier<span class="token punctuation">,</span>
      y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> <span class="token string">'black'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">.</span><span class="token function">fillRect</span><span class="token punctuation">(</span>
      x <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier<span class="token punctuation">,</span>
      y <span class="token operator">*</span> <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier<span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>multiplier
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="keys-2" style="position:relative;"><a href="#keys-2" aria-label="keys 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keys</h3>
<p>I had access to a lot more key event handlers with the DOM, so I was able to easily handle the keyup and keydown events without any hacks.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Set keys on key down</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keyIndex <span class="token operator">=</span> keyMap<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>key<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>keyIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_setKeys</span><span class="token punctuation">(</span>keyIndex<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Reset keys on keyup</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_resetKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="entrypoint-1" style="position:relative;"><a href="#entrypoint-1" aria-label="entrypoint 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Entrypoint</h3>
<p>I handled working with the modules by importing all of them and setting them to the global object, then using <a href="http://browserify.org/">Browserify</a> to use them in the browser. Setting them to the global makes them available on the window so I could use the code output in a browser script. Nowadays I might use Webpack or something else for this, but it was quick and simple.</p>
<div class="filename">web.js</div>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">CPU</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../classes/CPU'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> RomBuffer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../classes/RomBuffer'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> WebCpuInterface <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../classes/interfaces/WebCpuInterface'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> cpuInterface <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebCpuInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> cpu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CPU</span><span class="token punctuation">(</span>cpuInterface<span class="token punctuation">)</span>

<span class="token comment">// Set CPU and Rom Buffer to the global object, which will become window in the</span>
<span class="token comment">// browser after bundling.</span>
global<span class="token punctuation">.</span>cpu <span class="token operator">=</span> cpu
global<span class="token punctuation">.</span>RomBuffer <span class="token operator">=</span> RomBuffer</code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The web entrypoint uses the same <code class="language-text">cycle</code> function as the terminal implementation, but has a function to fetch each ROM and reset the display every time a new one is selected. I'm used to working with json data and fetch, but in this case I fetched the raw <code class="language-text">arrayBuffer</code> from the response.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token comment">// Fetch the ROM and load the game</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loadRom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> rom <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./roms/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>rom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> arrayBuffer <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span><span class="token function">arrayBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> uint8View <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>arrayBuffer<span class="token punctuation">)</span>
  <span class="token keyword">const</span> romBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RomBuffer</span><span class="token punctuation">(</span>uint8View<span class="token punctuation">)</span>

  cpu<span class="token punctuation">.</span>interface<span class="token punctuation">.</span><span class="token function">clearDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  cpu<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>romBuffer<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Add the ability to select a game</span>
document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span> loadRom<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>The HTML includes a <code class="language-text">canvas</code> and a <code class="language-text">select</code>.</p>
<div class="gatsby-highlight" data-language="html"><pre style="counter-reset: linenumber NaN" class="language-html line-numbers"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">disabled</span> <span class="token attr-name">selected</span><span class="token punctuation">></span></span>Load ROM...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CONNECT4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Connect4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PONG<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Pong<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Then I just deployed the code onto GitHub pages because it's static.</p>
<h2 id="native-app---interfacing-with-the-native-platform" style="position:relative;"><a href="#native-app---interfacing-with-the-native-platform" aria-label="native app   interfacing with the native platform permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Native App - Interfacing with the Native Platform</h2>
<p>I also made an experimental native UI implementation. I used <a href="https://www.raylib.com/">Raylib</a>, a programming library for programming simple games that had bindings for <a href="https://github.com/RobLoach/node-raylib">Node.js</a>.</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e64d5e1d044866b03b104fcfc6fde224/66632/connect4.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5UlEQVQoz52SQWsTQRTHfzM7u7NJakVbD0UpNfRQWpqoeDHrpZ6kCt4S0pJsFDwUL1IESRGDR/HqxbMQwU/jd/CkLJ6Chya7T3Z2LWkQRAf+zOP/3vu9x+wiIsjXL9dEftwSkYaINBc1mUyas9ms+adc2XNTRFZzFu9Hx/Qe7X8c9NrSP4wlfj6Q+OVjiQ/6Eg9iieNYOp2OdLtdFzsvz+U1ee1h3/ntdns4HA75fcaAAKeskFEng79og8zVwrTsHTlS4Bu01mPtadGoqa77md70M43KtNWZ1gsyusjtBpm+7upmrlfrkTHmbMNPKDdlyqrKOKkJDSNusoeUGxRS5b1jhHWdbzgrvRFz5zzwVU3Yt8KWdx72X8A1ndELhU4oDqwRzL8Dx6V5yopKeXchpRum3PFTHtiUqkqBFFUqj3dMyoaXuiWK3tfzwM9nky8r4agqHITi3nIvEJ5UhNsLb7pthDU9v/UbR1JKgeJD+fm/0fIT7tuEXZPw0CasewlH1YR7QQIkGIr7hkmInPcdxU/ghWPlTDR14C5LKuJZLUIRwZy2TcSWKWJdepsm4mm1iBUtFFeXl5fJ/0GCixaLwb69gpITgksVQsCCu7XsYaRFiMLWq87zpYGSY0J8gkqAXbJ4nscvQUIH/yIjkHoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="connect4"
        title="connect4"
        src="/static/e64d5e1d044866b03b104fcfc6fde224/5a190/connect4.png"
        srcset="/static/e64d5e1d044866b03b104fcfc6fde224/772e8/connect4.png 200w,
/static/e64d5e1d044866b03b104fcfc6fde224/e17e5/connect4.png 400w,
/static/e64d5e1d044866b03b104fcfc6fde224/5a190/connect4.png 800w,
/static/e64d5e1d044866b03b104fcfc6fde224/c1b63/connect4.png 1200w,
/static/e64d5e1d044866b03b104fcfc6fde224/66632/connect4.png 1504w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<p>I consider this version experimental just because it's really slow compared to the other ones, so it's less usable, but everything works correctly with the keys and screen.</p>
<h3 id="entrypoint-2" style="position:relative;"><a href="#entrypoint-2" aria-label="entrypoint 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Entrypoint</h3>
<p>Raylib works a bit differently than the other implementations because Raylib itself runs in a loop, meaning I won't end up using the <code class="language-text">cycle</code> function.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'raylib'</span><span class="token punctuation">)</span>

<span class="token comment">// As long as the window shouldn't close...</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>r<span class="token punctuation">.</span><span class="token function">WindowShouldClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Fetch, decode, execute</span>
  cpu<span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  r<span class="token punctuation">.</span><span class="token function">BeginDrawing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// Paint screen with amy changes</span>
  r<span class="token punctuation">.</span><span class="token function">EndDrawing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

r<span class="token punctuation">.</span><span class="token function">CloseWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="screen-3" style="position:relative;"><a href="#screen-3" aria-label="screen 3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Screen</h3>
<p>Within the <code class="language-text">beginDrawing()</code> and <code class="language-text">endDrawing()</code> methods, the screen will update. For the Raylib implementation I accessed the interface directly from the script instead of keeping everything contained in the interface, but it works.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js">r<span class="token punctuation">.</span><span class="token function">BeginDrawing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

cpu<span class="token punctuation">.</span>interface<span class="token punctuation">.</span>frameBuffer<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">y<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  y<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> j</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      r<span class="token punctuation">.</span><span class="token function">DrawRectangleRec</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token constant">GREEN</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      r<span class="token punctuation">.</span><span class="token function">DrawRectangleRec</span><span class="token punctuation">(</span><span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height <span class="token punctuation">}</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token constant">BLACK</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

r<span class="token punctuation">.</span><span class="token function">EndDrawing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h3 id="keys-3" style="position:relative;"><a href="#keys-3" aria-label="keys 3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Keys</h3>
<p>Getting the keys to work on Raylib was the last thing I worked on. It was more difficult to figure out because I had to do everything in the <code class="language-text">IsKeyDown</code> method - there was a <code class="language-text">GetKeyPressed</code> method, but it had side effects and caused problems. So instead of just waiting for a keypress like the other implementations, I had to loop through all keys and check if they were down, and append them to the key bitmask if so.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset: linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">let</span> keyDownIndices <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// Run through all possible keys</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nativeKeyMap<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> currentKey <span class="token operator">=</span> nativeKeyMap<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
  <span class="token comment">// If key is already down, add index to key down map</span>
  <span class="token comment">// This will also lift up any keys that aren't pressed</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">IsKeyDown</span><span class="token punctuation">(</span>currentKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keyDownIndices <span class="token operator">|=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set all pressed keys</span>
cpu<span class="token punctuation">.</span>interface<span class="token punctuation">.</span><span class="token function">setKeys</span><span class="token punctuation">(</span>keyDownIndices<span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space: normal; width: auto; left: 0;"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>That's it for the native implementation. It was more of a challenge than the other ones, but I'm glad I did it to round out the interface and see how well it would work on drastically different platforms.</p>
<h2 id="conclusion" style="position:relative;"><a href="#conclusion" aria-label="conclusion permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>So that's my Chip-8 project! Once again, you can <a href="https://github.com/taniarascia/chip8">check out the source</a> on GitHub. I learned a lot about lower level programming concepts and how a CPU operates, and also about the capabilities of JavaScript outside of a browser app or REST API server. I still have a few things left to do in this project, like attempt to make a (very) simple game, but the emulator is complete, and I'm proud to have finished it.</p></div></article><section id="comments" class="comments container"><h2>Comments</h2><div></div></section></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/writing-an-emulator-in-javascript-chip8/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-3d3abe80edde96e60783.js"],"app":["/app-2c67c096c1a7f0695165.js"],"component---src-pages-404-js":["/component---src-pages-404-js-d76829c69637006557b1.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-66650a6abbb0d281679c.js"],"component---src-pages-index-js":["/component---src-pages-index-js-5c9acbffdf2efd338ab0.js"],"component---src-pages-notes-js":["/component---src-pages-notes-js-cfe54b2a40be3b21c4a1.js"],"component---src-pages-projects-js":["/component---src-pages-projects-js-25992abc219b15b21e4d.js"],"component---src-templates-category-js":["/component---src-templates-category-js-52135eae98ea43ba7b30.js"],"component---src-templates-note-js":["/component---src-templates-note-js-573bf0a9a36243f2e71e.js"],"component---src-templates-page-js":["/component---src-templates-page-js-cbf0799a96c58c65aa62.js"],"component---src-templates-post-js":["/component---src-templates-post-js-855d4395f6fd9edac223.js"],"component---src-templates-tag-js":["/component---src-templates-tag-js-163b692971695ad5a520.js"]};/*]]>*/</script><script src="/polyfill-3d3abe80edde96e60783.js" nomodule=""></script><script src="/component---src-templates-post-js-855d4395f6fd9edac223.js" async=""></script><script src="/commons-99325db68594412750ba.js" async=""></script><script src="/app-2c67c096c1a7f0695165.js" async=""></script><script src="/framework-97155db9408cb0e3fcd4.js" async=""></script><script src="/webpack-runtime-a0e74d583841f3e0a74a.js" async=""></script></body></html>